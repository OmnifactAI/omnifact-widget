var OmnifactWidget=function(t){"use strict";class e{static defaults={endpointUrl:"",endpointId:"",apiKey:"",position:"bottom-right",title:"Chat with us",welcomeMessage:"Hello! How can I help you today?",primaryColor:"#6366f1",secondaryColor:"#818cf8",backgroundColor:"#ffffff",textColor:"#1f2937",storageKey:"omnifact-chat",enablePersistence:!0};static attributeMap={"endpoint-url":"endpointUrl","endpoint-id":"endpointId","api-key":"apiKey",position:"position",title:"title","welcome-message":"welcomeMessage","primary-color":"primaryColor","secondary-color":"secondaryColor","background-color":"backgroundColor","text-color":"textColor","storage-key":"storageKey","enable-persistence":"enablePersistence"};constructor(t){this.element=t,this.config={...e.defaults}}load(){return this._loadFromJsonScript(),this._loadFromAttributes(),this._validate(),this.config}_loadFromJsonScript(){const t=this.element.querySelector('script[type="application/json"]');if(t)try{const e=JSON.parse(t.textContent);Object.assign(this.config,this._normalizeConfig(e))}catch(t){console.error("[OmnifactWidget] Invalid JSON configuration:",t)}}_loadFromAttributes(){for(const[t,n]of Object.entries(e.attributeMap)){const e=this.element.getAttribute(t);null!==e&&(this.config[n]="enablePersistence"===n?"false"!==e:e)}}_normalizeConfig(t){const e={};for(const[n,s]of Object.entries(t)){e[n.replace(/-([a-z])/g,(t,e)=>e.toUpperCase())]=s}return e}_validate(){const t=[];this.config.endpointUrl||t.push("endpoint-url is required"),this.config.endpointId||t.push("endpoint-id is required"),t.length>0&&console.warn("[OmnifactWidget] Configuration warnings:",t.join(", "))}set(t,n){t in e.defaults&&(this.config[t]=n)}get(){return{...this.config}}}class n{static MAX_MESSAGES=100;static MAX_MESSAGE_LENGTH=1e4;static SESSION_TIMEOUT=864e5;constructor(t="omnifact-chat"){this.storageKey=t}getState(){try{const t=localStorage.getItem(this.storageKey);if(!t)return this._getDefaultState();const e=JSON.parse(t);return this._isSessionValid(e)?e:(this.clearState(),this._getDefaultState())}catch(t){return console.warn("[OmnifactWidget] Failed to load chat state:",t),this._getDefaultState()}}saveState(t){try{const e=t.messages.slice(-n.MAX_MESSAGES).map(t=>({...t,content:t.content?.slice(0,n.MAX_MESSAGE_LENGTH)||""})),s={sessionId:t.sessionId,messages:e,lastUpdated:Date.now(),version:1};localStorage.setItem(this.storageKey,JSON.stringify(s))}catch(e){"QuotaExceededError"===e.name?this._handleQuotaExceeded(t):console.warn("[OmnifactWidget] Failed to save chat state:",e)}}clearState(){try{localStorage.removeItem(this.storageKey)}catch(t){console.warn("[OmnifactWidget] Failed to clear chat state:",t)}}_isSessionValid(t){return!!t.lastUpdated&&Date.now()-t.lastUpdated<n.SESSION_TIMEOUT}_getDefaultState(){return{sessionId:this._generateSessionId(),messages:[],lastUpdated:null,version:1}}_generateSessionId(){return"undefined"!=typeof crypto&&crypto.randomUUID?"session-"+crypto.randomUUID():"session-"+Math.random().toString(36).substring(2,11)+Math.random().toString(36).substring(2,11)}_handleQuotaExceeded(t){try{const e=t.messages.slice(-Math.floor(n.MAX_MESSAGES/2)),s={sessionId:t.sessionId,messages:e,lastUpdated:Date.now(),version:1};localStorage.setItem(this.storageKey,JSON.stringify(s))}catch(t){console.warn("[OmnifactWidget] Failed to save chat state after cleanup:",t)}}}class s{constructor(t){this.baseUrl=t.endpointUrl,this.endpointId=t.endpointId,this.apiKey=t.apiKey}async sendMessage(t,e=!0){const n=`${this.baseUrl}/v1/endpoints/${this.endpointId}/chat`,s={"Content-Type":"application/json"};this.apiKey&&(s["X-API-Key"]=this.apiKey);const i=await fetch(n,{method:"POST",headers:s,body:JSON.stringify({messages:t.map(t=>({role:t.role,content:t.content})),streaming:e})});if(!i.ok){const t=await i.text().catch(()=>"Unknown error");throw new o(`API request failed: ${i.status}`,i.status,t)}return e?i:i.json()}updateConfig(t){t.endpointUrl&&(this.baseUrl=t.endpointUrl),t.endpointId&&(this.endpointId=t.endpointId),t.apiKey&&(this.apiKey=t.apiKey)}}class o extends Error{constructor(t,e,n){super(t),this.name="ApiError",this.status=e,this.responseText=n}}class i{async processStream(t,e){const{onChunk:n,onComplete:s,onError:o}=e,i=t.body.getReader(),r=new TextDecoder;let a="",c=null,l="",d=null;try{for(;;){const{done:t,value:e}=await i.read();if(t)break;a+=r.decode(e,{stream:!0});const o=a.split("\n");a=o.pop()||"";for(const t of o){const e=t.trim();if(e)if(e.startsWith("event: "))c=e.slice(7).trim();else if(!e.startsWith("id: ")&&e.startsWith("data: ")){const t=e.slice(6);if("assistant_write"===c)try{const e=JSON.parse(t);e.content&&(d=e.messageId||d,l+=e.content,n&&n(e.content,l,d))}catch(e){l+=t,n&&n(t,l,d)}else{if("done"===c)return s&&s(l,d),l;if("error"===c)try{const e=JSON.parse(t);throw new Error(e.message||"Stream error")}catch(e){throw new Error(t||"Stream error")}}}}}return s&&s(l,d),l}catch(t){throw o&&o(t),t}}}class r extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._state={isOpen:!1,messages:[],isTyping:!1,sessionId:null},this._config=null,this._storage=null,this._apiClient=null,this._sseHandler=new i,this._bubble=null,this._window=null,this._messageList=null,this._chatInput=null,this._typingIndicator=null}static get observedAttributes(){return["endpoint-url","endpoint-id","api-key","position","title","welcome-message","primary-color","secondary-color","background-color","text-color"]}connectedCallback(){const t=new e(this);this._config=t.load(),this._storage=new n(this._config.storageKey),this._apiClient=new s(this._config),this._initializeSession(),this.render(),this._setupComponentReferences(),this._applyTheme(),this._renderMessages(),this._setupEventListeners()}attributeChangedCallback(t,n,s){if(!this.isConnected||n===s)return;const o=new e(this);this._config=o.load(),this._apiClient&&this._apiClient.updateConfig(this._config),this._applyTheme(),"title"===t&&this._window&&this._window.setAttribute("title",this._config.title),"position"===t&&this._updatePosition()}_initializeSession(){if(this._config.enablePersistence){const t=this._storage.getState();this._state.sessionId=t.sessionId,this._state.messages=t.messages||[]}else this._state.sessionId=this._generateSessionId(),this._state.messages=[];0===this._state.messages.length&&this._config.welcomeMessage&&this._state.messages.push({id:"welcome",role:"assistant",content:this._config.welcomeMessage,timestamp:Date.now(),isWelcome:!0})}_generateSessionId(){return"undefined"!=typeof crypto&&crypto.randomUUID?"session-"+crypto.randomUUID():"session-"+Math.random().toString(36).substring(2,11)}_setupComponentReferences(){this._bubble=this.shadowRoot.querySelector("omnifact-chat-bubble"),this._window=this.shadowRoot.querySelector("omnifact-chat-window"),this._messageList=this.shadowRoot.querySelector("omnifact-message-list"),this._chatInput=this.shadowRoot.querySelector("omnifact-chat-input"),this._typingIndicator=this.shadowRoot.querySelector("omnifact-typing-indicator")}_applyTheme(){const{primaryColor:t,secondaryColor:e,backgroundColor:n,textColor:s}=this._config;this.style.setProperty("--omnifact-primary",t),this.style.setProperty("--omnifact-secondary",e),this.style.setProperty("--omnifact-background",n),this.style.setProperty("--omnifact-text",s),this._bubble&&(this._bubble.primaryColor=t),this._window&&this._window.setTheme(this._config),this._messageList&&this._messageList.setTheme(this._config),this._chatInput&&this._chatInput.setTheme(this._config),this._typingIndicator&&this._typingIndicator.setTheme(this._config)}_updatePosition(){const t=this._config.position;this._window&&this._window.setAttribute("position",t)}_setupEventListeners(){this._bubble.addEventListener("toggle",()=>{this._toggleChat()}),this._window.addEventListener("close",()=>{this._closeChat()}),this._chatInput.addEventListener("send",t=>{this._sendMessage(t.detail.message)})}_toggleChat(){this._state.isOpen=!this._state.isOpen,this._updateChatVisibility()}open(){this._state.isOpen=!0,this._updateChatVisibility()}_closeChat(){this._state.isOpen=!1,this._updateChatVisibility()}close(){this._closeChat()}_updateChatVisibility(){const t=this._state.isOpen;t?(this._window.removeAttribute("hidden"),this._bubble.hasUnread=!1,setTimeout(()=>{this._chatInput.focus(),this._messageList.scrollToBottom(!1)},100)):this._window.setAttribute("hidden",""),this._bubble.isOpen=t}_renderMessages(){this._messageList.querySelectorAll("omnifact-message-item").forEach(t=>t.remove());for(const t of this._state.messages)this._renderMessage(t)}_renderMessage(t,e=!1){const n=document.createElement("omnifact-message-item");return n.setAttribute("role",t.role),n.setAttribute("data-id",t.id),e&&n.setAttribute("streaming",""),n.content=t.content,n.setTheme(this._config),this._messageList.appendChild(n),n}async _sendMessage(t){if(!t.trim()||this._state.isTyping)return;const e={id:this._generateMessageId(),role:"user",content:t.trim(),timestamp:Date.now()};this._state.messages.push(e),this._renderMessage(e),this._messageList.scrollToBottom(),this._chatInput.disabled=!0,this._state.isTyping=!0,this._typingIndicator.show();const n=this._state.messages.filter(t=>!t.isWelcome).map(t=>({role:t.role,content:t.content}));try{const t={id:this._generateMessageId(),role:"assistant",content:"",timestamp:Date.now()},e=await this._apiClient.sendMessage(n,!0);this._typingIndicator.hide(),this._state.messages.push(t);const s=this._renderMessage(t,!0);let o=!0;await this._sseHandler.processStream(e,{onChunk:(e,n,i)=>{t.content=n,i&&(t.id=i),s.appendContent(e),o&&this._messageList.isNearBottom()&&this._messageList.scrollToBottom()},onComplete:(e,n)=>{t.content=e,n&&(t.id=n),s.removeAttribute("streaming"),this._saveState()},onError:t=>{console.error("[OmnifactWidget] Stream error:",t)}})}catch(t){console.error("[OmnifactWidget] Failed to send message:",t);const e={id:this._generateMessageId(),role:"assistant",content:"Sorry, I encountered an error. Please try again.",timestamp:Date.now(),isError:!0};this._state.messages.push(e),this._renderMessage(e)}finally{this._chatInput.disabled=!1,this._state.isTyping=!1,this._typingIndicator.hide(),this._chatInput.focus(),this._saveState()}}_generateMessageId(){return"undefined"!=typeof crypto&&crypto.randomUUID?"msg-"+crypto.randomUUID():"msg-"+Math.random().toString(36).substring(2,11)}_saveState(){this._config.enablePersistence&&this._storage&&this._storage.saveState({sessionId:this._state.sessionId,messages:this._state.messages})}clearHistory(){this._state.messages=[],this._config.welcomeMessage&&this._state.messages.push({id:"welcome",role:"assistant",content:this._config.welcomeMessage,timestamp:Date.now(),isWelcome:!0}),this._storage&&this._storage.clearState(),this._renderMessages()}sendMessage(t){this._state.isOpen||this.open(),this._sendMessage(t)}render(){const t=this._config.position||"bottom-right";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          --omnifact-primary: ${this._config.primaryColor};\n          --omnifact-secondary: ${this._config.secondaryColor};\n          --omnifact-background: ${this._config.backgroundColor};\n          --omnifact-text: ${this._config.textColor};\n\n          position: fixed;\n          z-index: 9999;\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;\n        }\n\n        :host([position="bottom-right"]),\n        :host(:not([position])) {\n          bottom: 20px;\n          right: 20px;\n        }\n\n        :host([position="bottom-left"]) {\n          bottom: 20px;\n          left: 20px;\n        }\n\n        .container {\n          position: relative;\n        }\n      </style>\n\n      <div class="container">\n        <omnifact-chat-window\n          title="${this._config.title}"\n          hidden\n          position="${t}"\n        >\n          <omnifact-message-list></omnifact-message-list>\n          <omnifact-typing-indicator hidden></omnifact-typing-indicator>\n          <omnifact-chat-input></omnifact-chat-input>\n        </omnifact-chat-window>\n\n        <omnifact-chat-bubble></omnifact-chat-bubble>\n      </div>\n    `,this.setAttribute("position",t)}}class a extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._hasUnread=!1}connectedCallback(){this.render(),this._setupEventListeners()}set hasUnread(t){this._hasUnread=t;const e=this.shadowRoot.querySelector(".bubble");e&&e.classList.toggle("pulse",t)}get hasUnread(){return this._hasUnread}set primaryColor(t){this.style.setProperty("--bubble-color",t)}set isOpen(t){this._isOpen=t;const e=this.shadowRoot.querySelector(".chat-icon"),n=this.shadowRoot.querySelector(".close-icon");e&&n&&(e.style.display=t?"none":"block",n.style.display=t?"block":"none")}_setupEventListeners(){this.shadowRoot.querySelector(".bubble").addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("toggle",{bubbles:!0,composed:!0}))})}render(){this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          --bubble-color: #6366f1;\n          display: block;\n        }\n\n        .bubble {\n          width: 60px;\n          height: 60px;\n          border-radius: 50%;\n          background: var(--bubble-color);\n          border: none;\n          cursor: pointer;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n          transition: transform 0.2s ease, box-shadow 0.2s ease;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: relative;\n          padding: 0;\n        }\n\n        .bubble:hover {\n          transform: scale(1.05);\n          box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);\n        }\n\n        .bubble:active {\n          transform: scale(0.95);\n        }\n\n        .bubble.pulse::after {\n          content: \'\';\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          border-radius: 50%;\n          background: var(--bubble-color);\n          animation: pulse 2s infinite;\n          z-index: -1;\n        }\n\n        @keyframes pulse {\n          0% {\n            transform: scale(1);\n            opacity: 0.7;\n          }\n          100% {\n            transform: scale(1.5);\n            opacity: 0;\n          }\n        }\n\n        .icon {\n          width: 28px;\n          height: 28px;\n          fill: white;\n        }\n\n        .close-icon {\n          display: none;\n        }\n      </style>\n\n      <button class="bubble" aria-label="Open chat">\n        <svg class="icon chat-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n          <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.17L4 17.17V4h16v12z"/>\n          <path d="M7 9h10v2H7zm0-3h10v2H7z"/>\n        </svg>\n        <svg class="icon close-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n        </svg>\n      </button>\n    '}}class c extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}static get observedAttributes(){return["title","hidden"]}connectedCallback(){this.render(),this._setupEventListeners()}attributeChangedCallback(t,e,n){if("title"===t&&this.isConnected){const t=this.shadowRoot.querySelector(".header-title");t&&(t.textContent=n||"Chat")}}setTheme(t){const e=this.style;t.primaryColor&&e.setProperty("--primary-color",t.primaryColor),t.backgroundColor&&e.setProperty("--background-color",t.backgroundColor),t.textColor&&e.setProperty("--text-color",t.textColor)}_setupEventListeners(){this.shadowRoot.querySelector(".close-btn").addEventListener("click",()=>{this.dispatchEvent(new CustomEvent("close",{bubbles:!0,composed:!0}))})}render(){const t=this.getAttribute("title")||"Chat";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          --primary-color: #6366f1;\n          --background-color: #ffffff;\n          --text-color: #1f2937;\n          --border-color: #e5e7eb;\n\n          display: flex;\n          flex-direction: column;\n          position: absolute;\n          bottom: 76px;\n          right: 0;\n          width: 380px;\n          height: 600px;\n          max-height: calc(100vh - 100px);\n          max-width: calc(100vw - 40px);\n          background: var(--background-color);\n          border-radius: 16px;\n          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);\n          overflow: hidden;\n          transform-origin: bottom right;\n          transition: transform 0.3s ease, opacity 0.3s ease;\n        }\n\n        :host([hidden]) {\n          display: flex;\n          transform: scale(0.9) translateY(10px);\n          opacity: 0;\n          pointer-events: none;\n        }\n\n        :host([position="bottom-left"]) {\n          right: auto;\n          left: 0;\n          transform-origin: bottom left;\n        }\n\n        .header {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 16px 20px;\n          background: var(--primary-color);\n          color: white;\n          flex-shrink: 0;\n        }\n\n        .header-title {\n          font-size: 16px;\n          font-weight: 600;\n          margin: 0;\n        }\n\n        .close-btn {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 4px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          border-radius: 4px;\n          transition: background-color 0.2s;\n        }\n\n        .close-btn:hover {\n          background: rgba(255, 255, 255, 0.2);\n        }\n\n        .close-btn svg {\n          width: 20px;\n          height: 20px;\n          fill: white;\n        }\n\n        .content {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          overflow: hidden;\n        }\n\n        ::slotted(*) {\n          flex: 1;\n        }\n      </style>\n\n      <div class="header">\n        <h2 class="header-title">${t}</h2>\n        <button class="close-btn" aria-label="Close chat">\n          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n          </svg>\n        </button>\n      </div>\n\n      <div class="content">\n        <slot></slot>\n      </div>\n    `}}class l extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}scrollToBottom(t=!0){const e=this.shadowRoot.querySelector(".messages");e&&e.scrollTo({top:e.scrollHeight,behavior:t?"smooth":"auto"})}isNearBottom(){const t=this.shadowRoot.querySelector(".messages");if(!t)return!0;return t.scrollHeight-t.scrollTop-t.clientHeight<100}setTheme(t){t.backgroundColor&&this.style.setProperty("--background-color",t.backgroundColor)}render(){this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          --background-color: #ffffff;\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          overflow: hidden;\n        }\n\n        .messages {\n          flex: 1;\n          overflow-y: auto;\n          padding: 16px;\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n          background: var(--background-color);\n        }\n\n        .messages::-webkit-scrollbar {\n          width: 6px;\n        }\n\n        .messages::-webkit-scrollbar-track {\n          background: transparent;\n        }\n\n        .messages::-webkit-scrollbar-thumb {\n          background: #d1d5db;\n          border-radius: 3px;\n        }\n\n        .messages::-webkit-scrollbar-thumb:hover {\n          background: #9ca3af;\n        }\n\n        ::slotted(*) {\n          flex-shrink: 0;\n        }\n      </style>\n\n      <div class="messages">\n        <slot></slot>\n      </div>\n    '}}class d{constructor(t={}){this.options={sanitize:!0,linkTarget:"_blank",...t}}render(t){if(!t)return"";let e=this.options.sanitize?this._escapeHtml(t):t;return e=this._renderCodeBlocks(e),e=this._renderInlineCode(e),e=this._renderHeaders(e),e=this._renderBold(e),e=this._renderItalic(e),e=this._renderLinks(e),e=this._renderLists(e),e=this._renderLineBreaks(e),e}_escapeHtml(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,t=>e[t])}_renderCodeBlocks(t){return t.replace(/```(\w*)\n([\s\S]*?)```/g,(t,e,n)=>`<pre><code${e?` class="language-${e}"`:""}>${n.trim()}</code></pre>`)}_renderInlineCode(t){return t.replace(/`([^`]+)`/g,"<code>$1</code>")}_renderHeaders(t){return t.replace(/^### (.+)$/gm,"<h4>$1</h4>").replace(/^## (.+)$/gm,"<h3>$1</h3>").replace(/^# (.+)$/gm,"<h2>$1</h2>")}_renderBold(t){return t.replace(/\*\*(.+?)\*\*|__(.+?)__/g,(t,e,n)=>`<strong>${e||n}</strong>`)}_renderItalic(t){return t.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g,"<em>$1</em>")}_renderLinks(t){const e=this.options.linkTarget;return t.replace(/\[([^\]]+)\]\(([^)]+)\)/g,`<a href="$2" target="${e}" rel="noopener noreferrer">$1</a>`)}_renderLists(t){const e=t.split("\n"),n=[];let s=!1;for(const t of e){const e=t.match(/^[\-\*]\s+(.+)$/);e?(s||(n.push("<ul>"),s=!0),n.push(`<li>${e[1]}</li>`)):(s&&(n.push("</ul>"),s=!1),n.push(t))}return s&&n.push("</ul>"),n.join("\n")}_renderLineBreaks(t){return t.split("\n").map((t,e,n)=>{if(t.startsWith("<pre>")||t.startsWith("<ul>")||t.startsWith("</pre>")||t.startsWith("</ul>")||t.startsWith("<li>")||t.startsWith("<h"))return t;const s=n[e+1];return s&&!s.startsWith("<")&&t.trim()?t+"<br>":t}).join("\n")}}class h extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._content="",this._markdownRenderer=new d}static get observedAttributes(){return["role","streaming"]}connectedCallback(){this.render()}attributeChangedCallback(t,e,n){this.isConnected&&this.render()}set content(t){this._content=t||"",this._updateContent()}get content(){return this._content}appendContent(t){this._content+=t,this._updateContent()}setTheme(t){const e=this.style;t.primaryColor&&e.setProperty("--primary-color",t.primaryColor),t.textColor&&e.setProperty("--text-color",t.textColor)}_updateContent(){const t=this.shadowRoot.querySelector(".content");t&&(t.innerHTML=this._markdownRenderer.render(this._content))}render(){const t=this.getAttribute("role")||"user",e=this.hasAttribute("streaming");this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          --primary-color: #6366f1;\n          --text-color: #1f2937;\n          --user-bg: var(--primary-color);\n          --assistant-bg: #f3f4f6;\n          display: block;\n        }\n\n        .message {\n          display: flex;\n          gap: 8px;\n          max-width: 85%;\n        }\n\n        .message.user {\n          margin-left: auto;\n          flex-direction: row-reverse;\n        }\n\n        .message.assistant {\n          margin-right: auto;\n        }\n\n        .avatar {\n          width: 32px;\n          height: 32px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          flex-shrink: 0;\n          font-size: 14px;\n          background: #e5e7eb;\n        }\n\n        .message.user .avatar {\n          background: var(--user-bg);\n          color: white;\n        }\n\n        .bubble {\n          padding: 10px 14px;\n          border-radius: 16px;\n          line-height: 1.5;\n          word-wrap: break-word;\n          overflow-wrap: break-word;\n        }\n\n        .message.user .bubble {\n          background: var(--user-bg);\n          color: white;\n          border-bottom-right-radius: 4px;\n        }\n\n        .message.assistant .bubble {\n          background: var(--assistant-bg);\n          color: var(--text-color);\n          border-bottom-left-radius: 4px;\n        }\n\n        .content {\n          font-size: 14px;\n        }\n\n        /* Markdown styles */\n        .content h2, .content h3, .content h4 {\n          margin: 0.5em 0 0.25em;\n          font-weight: 600;\n        }\n\n        .content h2 { font-size: 1.2em; }\n        .content h3 { font-size: 1.1em; }\n        .content h4 { font-size: 1em; }\n\n        .content p {\n          margin: 0.25em 0;\n        }\n\n        .content code {\n          background: rgba(0, 0, 0, 0.08);\n          padding: 0.1em 0.3em;\n          border-radius: 3px;\n          font-family: 'Fira Code', 'Consolas', monospace;\n          font-size: 0.9em;\n        }\n\n        .message.user .content code {\n          background: rgba(255, 255, 255, 0.2);\n        }\n\n        .content pre {\n          background: #1f2937;\n          color: #f3f4f6;\n          padding: 10px 12px;\n          border-radius: 8px;\n          overflow-x: auto;\n          margin: 0.5em 0;\n          font-size: 13px;\n        }\n\n        .content pre code {\n          background: none;\n          padding: 0;\n          color: inherit;\n        }\n\n        .content ul {\n          margin: 0.5em 0;\n          padding-left: 1.25em;\n        }\n\n        .content li {\n          margin: 0.2em 0;\n        }\n\n        .content a {\n          color: inherit;\n          text-decoration: underline;\n        }\n\n        .content strong {\n          font-weight: 600;\n        }\n\n        .content em {\n          font-style: italic;\n        }\n\n        /* Streaming cursor */\n        .streaming .content::after {\n          content: '\\25AE';\n          animation: blink 1s infinite;\n          margin-left: 2px;\n        }\n\n        @keyframes blink {\n          0%, 50% { opacity: 1; }\n          51%, 100% { opacity: 0; }\n        }\n      </style>\n\n      <div class="message ${t} ${e?"streaming":""}">\n        <div class="avatar">${"user"===t?"&#128100;":"&#129302;"}</div>\n        <div class="bubble">\n          <div class="content">${this._markdownRenderer.render(this._content)}</div>\n        </div>\n      </div>\n    `}}class p extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._disabled=!1}static get observedAttributes(){return["disabled","placeholder"]}connectedCallback(){this.render(),this._setupEventListeners()}attributeChangedCallback(t,e,n){if(this.isConnected)if("disabled"===t)this._disabled=null!==n,this._updateDisabledState();else if("placeholder"===t){const t=this.shadowRoot.querySelector("textarea");t&&(t.placeholder=n||"Type a message...")}}set disabled(t){this._disabled=t,t?this.setAttribute("disabled",""):this.removeAttribute("disabled"),this._updateDisabledState()}get disabled(){return this._disabled}focus(){const t=this.shadowRoot.querySelector("textarea");t&&t.focus()}clear(){const t=this.shadowRoot.querySelector("textarea");t&&(t.value="",this._adjustHeight(t))}setTheme(t){const e=this.style;t.primaryColor&&e.setProperty("--primary-color",t.primaryColor),t.backgroundColor&&e.setProperty("--background-color",t.backgroundColor),t.textColor&&e.setProperty("--text-color",t.textColor)}_updateDisabledState(){const t=this.shadowRoot.querySelector("textarea"),e=this.shadowRoot.querySelector("button");t&&(t.disabled=this._disabled),e&&(e.disabled=this._disabled)}_setupEventListeners(){const t=this.shadowRoot.querySelector("textarea"),e=this.shadowRoot.querySelector("button");t.addEventListener("input",()=>{this._adjustHeight(t)}),t.addEventListener("keydown",t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),this._send())}),e.addEventListener("click",()=>{this._send()})}_adjustHeight(t){t.style.height="auto";t.style.height=Math.min(t.scrollHeight,120)+"px"}_send(){if(this._disabled)return;const t=this.shadowRoot.querySelector("textarea"),e=t.value.trim();e&&(this.dispatchEvent(new CustomEvent("send",{bubbles:!0,composed:!0,detail:{message:e}})),t.value="",this._adjustHeight(t))}render(){const t=this.getAttribute("placeholder")||"Type a message...";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          --primary-color: #6366f1;\n          --background-color: #ffffff;\n          --text-color: #1f2937;\n          --border-color: #e5e7eb;\n          display: block;\n          padding: 12px 16px;\n          background: var(--background-color);\n          border-top: 1px solid var(--border-color);\n        }\n\n        .input-container {\n          display: flex;\n          gap: 8px;\n          align-items: flex-end;\n        }\n\n        textarea {\n          flex: 1;\n          resize: none;\n          border: 1px solid var(--border-color);\n          border-radius: 20px;\n          padding: 10px 16px;\n          font-size: 14px;\n          font-family: inherit;\n          line-height: 1.4;\n          max-height: 120px;\n          min-height: 40px;\n          height: 40px;\n          background: var(--background-color);\n          color: var(--text-color);\n          outline: none;\n          transition: border-color 0.2s;\n        }\n\n        textarea:focus {\n          border-color: var(--primary-color);\n        }\n\n        textarea:disabled {\n          background: #f9fafb;\n          cursor: not-allowed;\n        }\n\n        textarea::placeholder {\n          color: #9ca3af;\n        }\n\n        button {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          border: none;\n          background: var(--primary-color);\n          cursor: pointer;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: transform 0.2s, background-color 0.2s;\n          flex-shrink: 0;\n        }\n\n        button:hover:not(:disabled) {\n          transform: scale(1.05);\n        }\n\n        button:active:not(:disabled) {\n          transform: scale(0.95);\n        }\n\n        button:disabled {\n          background: #d1d5db;\n          cursor: not-allowed;\n        }\n\n        button svg {\n          width: 20px;\n          height: 20px;\n          fill: white;\n        }\n      </style>\n\n      <div class="input-container">\n        <textarea\n          placeholder="${t}"\n          rows="1"\n          ${this._disabled?"disabled":""}\n        ></textarea>\n        <button\n          type="button"\n          aria-label="Send message"\n          ${this._disabled?"disabled":""}\n        >\n          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>\n          </svg>\n        </button>\n      </div>\n    `}}class g extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}show(){this.removeAttribute("hidden")}hide(){this.setAttribute("hidden","")}setTheme(t){t.primaryColor&&this.style.setProperty("--dot-color",t.primaryColor)}render(){this.shadowRoot.innerHTML='\n      <style>\n        :host {\n          --dot-color: #6366f1;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          padding: 8px 0;\n        }\n\n        :host([hidden]) {\n          display: none;\n        }\n\n        .avatar {\n          width: 32px;\n          height: 32px;\n          border-radius: 50%;\n          background: #e5e7eb;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 14px;\n          flex-shrink: 0;\n        }\n\n        .dots {\n          display: flex;\n          gap: 4px;\n          padding: 12px 16px;\n          background: #f3f4f6;\n          border-radius: 16px;\n          border-bottom-left-radius: 4px;\n        }\n\n        .dot {\n          width: 8px;\n          height: 8px;\n          border-radius: 50%;\n          background: var(--dot-color);\n          opacity: 0.4;\n          animation: bounce 1.4s infinite ease-in-out;\n        }\n\n        .dot:nth-child(1) {\n          animation-delay: 0s;\n        }\n\n        .dot:nth-child(2) {\n          animation-delay: 0.2s;\n        }\n\n        .dot:nth-child(3) {\n          animation-delay: 0.4s;\n        }\n\n        @keyframes bounce {\n          0%, 80%, 100% {\n            transform: translateY(0);\n            opacity: 0.4;\n          }\n          40% {\n            transform: translateY(-6px);\n            opacity: 1;\n          }\n        }\n      </style>\n\n      <div class="avatar">&#129302;</div>\n      <div class="dots">\n        <div class="dot"></div>\n        <div class="dot"></div>\n        <div class="dot"></div>\n      </div>\n    '}}
/**
   * Omnifact Chat Widget
   * Embeddable AI chat widget for Omnifact endpoints.
   *
   * @license MIT
   */const u=(t,e)=>{customElements.get(t)||customElements.define(t,e)};return u("omnifact-chat-widget",r),u("omnifact-chat-bubble",a),u("omnifact-chat-window",c),u("omnifact-message-list",l),u("omnifact-message-item",h),u("omnifact-chat-input",p),u("omnifact-typing-indicator",g),console.log("[OmnifactWidget] Initialized"),t.ApiClient=s,t.ChatBubble=a,t.ChatInput=p,t.ChatWindow=c,t.ConfigManager=e,t.MarkdownRenderer=d,t.MessageItem=h,t.MessageList=l,t.OmnifactChatWidget=r,t.SSEHandler=i,t.StorageService=n,t.TypingIndicator=g,t.default=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
